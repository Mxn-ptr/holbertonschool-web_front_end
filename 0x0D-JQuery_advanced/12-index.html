<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Task 0</title>
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <script type="application/javascript">
      $(document).ready(() => {
        $.addPostRow = (data) => {
          $("body").append(
            $(`<p id='row-${data.id}'>`).append(
              $("<span>").text("(delete)").click(function() {$.deletePost(data.id)}),
              $("<span>").text(
                `Post created with id ${data.id}, title: ${data.title}, author: ${data.author}`
              )
            )
          );
        };
        $.deletePost = (id) => {
          $.ajax({
            type: "DELETE",
            url: `http://localhost:3000/posts/${id}`,
            success : $(`#row-${id}`).remove()
          }).fail(() => alert("Post was not deleted"))
        }
        $.listPosts = () => {
          $.get("http://localhost:3000/posts", function (data) {
            data.forEach((d) => $.addPostRow(d));
          }).fail(() => {
            alert("Server Error");
          });
        };
        $.buildForm = () => {
          $("body").append("<form>");
          $("form").append(
            $("<div>").append(
              $("<label>").attr("for", "author").text("Author"),
              $("<input>").attr({ type: "text", id: "author" })
            )
          );
          $("form").append(
            $("<div>").append(
              $("<label>").attr("for", "title").text("Title"),
              $("<textarea>").attr({ id: "title" })
            )
          );
          $("form").append($("<input>").attr("type", "submit").click(function() {$.sendForm()}));
        };
        $.sendForm = () => {
          $("form").after($("<p>").text("About to send the query to the API"));
          let data = {
            title: $("#title").val(),
            author: $("#author").val(),
          };
          $.ajax({
            type: "POST",
            data: data,
            url: "http://localhost:3000/posts",
            success : (res) => $.addPostRow(res)
          }).fail(() => alert("Error sending the POST query"))
        }
        $.listPosts();
        $.buildForm();
        $("label").click(function() {
          $("label").closest("input").focus();
        });
        $("input").keypress(function(event) {
          if (event.which === 13) {
            $.sendForm();
          }
        })
        $("textarea").keypress(function(event) {
          if (event.which === 13) {
            $.sendForm();
          }
        })
      });
    </script>
  </body>
</html>
